version: 1.0.{build}

image:
  - Visual Studio 2017
  - Ubuntu

platform:
  - x86
  #- x64

shallow_clone: true
clone_depth: 1

matrix:
  fast_finish: false # set this flag to immediately finish build once one of the jobs fails.

init:
  - ps: |
      Write-Host "Build worker environment variables:" -ForegroundColor Magenta
      Get-ChildItem Env: | %{"{0}={1}" -f $_.Name,$_.Value}

install:
  - ps: ./.ci/install-cmake.ps1
  - cmd: dir c:\cmake
  - cmd: set PATH=C:\cmake\bin;%PATH%
  - sh: sudo sh ./.ci/install-cmake.sh
  - cmake --version

build: off

before_build:
  - ps: 'Write-Host "Building ci-test:" -ForegroundColor Magenta'
  - mkdir _build
  - cd _build

build_script:
  - ps: 'Write-Host "Configuring:" -ForegroundColor Magenta'
  - ps: cmake $env:APPVEYOR_BUILD_FOLDER
  - ps: 'Write-Host "Building:" -ForegroundColor Magenta'
  - cmake --build .
  - ctest -V --output-on-failure
