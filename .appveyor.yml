version: 1.0.{build}

image:
  - Visual Studio 2017
  - Ubuntu

platform:
  - x64
  - x86

shallow_clone: true
clone_depth: 1

matrix:
  fast_finish: false # set this flag to immediately finish build once one of the jobs fails.

init:
  - ps: |
      Write-Host "Build worker environment variables:" -ForegroundColor Magenta
      Get-ChildItem Env: | %{"{0}={1}" -f $_.Name,$_.Value}

install:
  - cmd: appveyor-retry appveyor DownloadFile https://cmake.org/files/v3.12/cmake-3.12.3-win64-x64.zip
  - cmd: 7z x cmake-3.12.3-win64-x64.zip -oC:\cmake > nul
  - cmd: set PATH=C:\cmake\bin;%PATH%
  - sh: wget -O cmake-linux.sh https://cmake.org/files/v3.12/cmake-3.12.3-Linux-x86_64.sh
  - sh: sudo sh cmake-linux.sh -- --skip-license --prefix=/usr/local
  - sh: export PATH=/usr/local/bin:$PATH
  - cmake --version

build: off

before_build:
  - ps: 'Write-Host "Building ci-test:" -ForegroundColor Magenta'
  - mkdir _build
  - cd _build

build_script:
  - ps: 'Write-Host "Configuring:" -ForegroundColor Magenta'
  - cmake %APPVEYOR_BUILD_FOLDER%
  - ps: 'Write-Host "Building:" -ForegroundColor Magenta'
  - cmake --build .
  - ctest --output-on-failure
