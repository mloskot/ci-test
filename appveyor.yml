version: 1.0.{build}

os: Visual Studio 2015

platform:
- x64
- x86

configuration: Release

shallow_clone: true
clone_depth: 1

matrix:
  fast_finish: false # set this flag to immediately finish build once one of the jobs fails.

init:
  - ps: |
      Write-Host "Build worker environment variables:" -ForegroundColor Magenta
      Get-ChildItem Env: | %{"{0}={1}" -f $_.Name,$_.Value}

install:
  - ps: 'Write-Host "Installing SQLite ODBC Driver:" -ForegroundColor Magenta'

before_build:
  - ps: 'Write-Host "Building jxrlib:" -ForegroundColor Magenta'
  - cmd: appveyor DownloadFile "http://download-codeplex.sec.s-msft.com/Download/Release?ProjectName=jxrlib&DownloadId=685249&FileTime=130142428055530000&Build=21050" -FileName jxrlib_1_1.zip
  - cmd: 7z x jxrlib_1_1.zip -oC:\jxrlib_1_1 > nul
  - cmd: cd C:\jxrlib_1_1\jxrlib\jxrencoderdecoder
  - cmd: if "%platform%" == "x86" msbuild /p:Configuration=Release /p:Platform=Win32 JXR_vc11.sln
  - cmd: if "%platform%" == "x64" msbuild /p:Configuration=Release /p:Platform=x64 JXR_vc11.sln
  - cmd: cd %APPVEYOR_BUILD_FOLDER%

build: off

build_script:
  - ps: 'Write-Host "Building ci-test:" -ForegroundColor Magenta'
  - cmd: mkdir build
  - cmd: cd build
  - ps: 'Write-Host "Running CMake:" -ForegroundColor Magenta'
  - cmd: if "%platform%" == "x86" cmake.exe -G "Visual Studio 14 2015" %APPVEYOR_BUILD_FOLDER%
  - cmd: if "%platform%" == "x64" cmake.exe -G "Visual Studio 14 2015 Win64" %APPVEYOR_BUILD_FOLDER%
  - ps: 'Write-Host "Running MSBuild:" -ForegroundColor Magenta'
  - cmd: if "%platform%" == "x86" msbuild /p:Configuration=Release /p:Platform=Win32 ci-test.sln
  - cmd: if "%platform%" == "x64" msbuild /p:Configuration=Release /p:Platform=x64 ci-test.sln

# If you need to debug AppVeyor session (https://www.appveyor.com/docs/how-to/rdp-to-build-worker), then:
# 1. Uncomment the on_finish section below:
#on_finish:
#  - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
# 2. Add this line to the init section below
#- ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
